@model Presentation.Models.SavingGoalsModel

@{
    ViewBag.Title = "All saving goals";
    Layout = "_Layout";
    string SuccesMessage = ViewBag.SuccesMessage;
    string ErrorMessage = ViewBag.ErrorMessage;
}

<main class="overflow-visible">
    <div class="flex flex-row justify-between items-center mb-8">
        <h1 class="text-3xl font-bold">Saving Goals</h1>
        <a asp-controller="Transactions" asp-action="Add"
           class="bg-blue-600 hover:bg-blue-700 py-2 px-4 rounded-xl text-white inline-block">Add</a>
    </div>

    @if (SuccesMessage != null)
    {
        <span>@SuccesMessage</span>
    }
    @if (ErrorMessage != null)
    {
        <span>@ErrorMessage</span>
    }

    <div class="flex flex-row w-full gap-3 mb-8">
        <div class="bg-[#F7F7F7] h-48 w-full rounded-xl px-3 py-3 flex flex-col justify-between shadow-md border-1">
            <h2 class="text-2xl font-bold">Monthly saving goal:</h2>
            <h3 class="text-5xl">€200</h3>
            <span>To reach all of your goals.</span>
        </div>
        <div class="bg-[#F7F7F7] h-48 w-full rounded-xl px-3 py-3 flex flex-col justify-between shadow-md border-1">
            <h2 class="text-2xl font-bold">Total money saved:</h2>
            <h3 class="text-5xl">€1275</h3>
            <span>You have saved for a total of 23 saving goals.</span>

        </div>
        <div class="bg-[#F7F7F7] h-48 w-full rounded-xl px-3 py-3 flex flex-col justify-between shadow-md border-1">
            <h2 class="text-2xl font-bold">uhhh</h2>
            <h3 class="text-5xl">€20</h3>
            <span>Ik heb geen flauw idee wat hier moet komen te staan.</span>

        </div>
    </div>

    <table class="min-w-full leading-normal text-left table-auto border-collapse rounded-lg overflow-visible">
        <tbody>
        @foreach (var savingGoal in Model.SavingGoals)
        {
            <a asp-action="Edit" asp-controller="Transactions">
                <tr class="bg-white/10 hover:bg-gray-200 border-b border-t border-gray-500/25">
                    <td class="py-3 px-4">@savingGoal.Name</td>
                    <td class="py-3 px-4">€@savingGoal.Target</td>
                    <td class="py-3 px-4 flex flex-row gap-2">@savingGoal.Deadline</td>
                    <td>
                        <div class="relative inline-block text-left js-dropdown-container overflow-visible">
                            <button
                                class="js-dropdown-button border-1 border-gray-500/25 py-2 pl-3 pr-4 rounded-xl text-gray-500 font-semibold flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 pointer-events-none"
                                     viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                          clip-rule="evenodd"/>
                                </svg>
                                Actions
                            </button>

                            <div
                                class="js-dropdown-menu z-40 absolute hidden mt-2 w-40 rounded-xl shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none"
                                role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                                <div class="py-1" role="none">
                                    <a asp-action="Details" asp-controller="SavingGoal" asp-route-id="@savingGoal.Id"
                                       role="menuitem" tabindex="-1"
                                       class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Details</a>
                                    <a asp-action="Edit" asp-controller="SavingGoal" asp-route-id="@savingGoal.Id"
                                       role="menuitem" tabindex="-1"
                                       class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Edit</a>
                                    <a asp-action="Remove" asp-controller="SavingGoal" asp-route-id="@savingGoal.Id"
                                       role="menuitem" tabindex="-1"
                                       class="block px-4 py-2 text-sm text-red-500 hover:text-red-600 hover:bg-gray-100">Remove</a>
                                </div>
                            </div>
                        </div>

                    </td>
                </tr>
            </a>
        }
        </tbody>
    </table>
</main>



<script>
    const dropdownButtons = document.querySelectorAll('.js-dropdown-button');

    function closeAllDropdowns(exceptButton = null) {

        document.querySelectorAll('.js-dropdown-menu').forEach(menu => {

            const parentButton = menu.previousElementSibling;

            if (parentButton !== exceptButton) {
                menu.classList.add('hidden');
            }
        });
    }

    dropdownButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            event.stopPropagation();

            const menu = button.nextElementSibling;

            if (menu) {
                const isHidden = menu.classList.contains('hidden');
                closeAllDropdowns(button);
                menu.classList.toggle('hidden', !isHidden);
            }
        });
    });

    document.addEventListener('click', (event) => {
        const clickedInside = event.target.closest('.js-dropdown-container');
        if (!clickedInside) {
            closeAllDropdowns();
        }
        if (event.target.closest('svg') && event.target.closest('.js-dropdown-button')) {
        }
    });
</script>